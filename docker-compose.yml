version: '3.8'

services:
  imx93-dev:
    build:
      context: .
      dockerfile: Dockerfile
      target: dev
    container_name: imx93-dev-env
    image: imx93-dev-env:latest
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      # Mount the entire project directory
      - .:/workspace
      # Persist Poetry cache (use host user home)
      - poetry-cache:/home/user/.cache/pypoetry
      # Persist Conan cache (use host user home)
      - conan-cache:/home/user/.conan2
    working_dir: /workspace
    # Keep container running
    stdin_open: true
    tty: true
    # Optional: add network configuration if needed
    # network_mode: bridge
    environment:
      - AARCH64_TOOLCHAIN=/usr/bin
      - ARM_NONE_EABI_BIN=/usr/bin
      - CONAN_PROFILE=default
      - POETRY_VIRTUALENVS_IN_PROJECT=true
      - HOME=/home/user
      - USER=user
    # Optional: limit resources
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '4'
    #       memory: 8G

volumes:
  poetry-cache:
  conan-cache:
